<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Enterprise PDF Editor</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>

<style>
/* ===== ENTERPRISE DARK THEME ===== */
body {
  margin: 0;
  font-family: Inter, system-ui;
  background: #020617;
  color: #e5e7eb;
}

.topbar {
  position: sticky;
  top: 0;
  height: 56px;
  background: rgba(11,16,32,0.95);
  border-bottom: 1px solid #1e293b;
  display: flex;
  align-items: center;
  padding: 0 16px;
  gap: 12px;
  z-index: 100;
}

.toolbar-btn {
  padding: 6px 10px;
  border-radius: 6px;
  color: #94a3b8;
  cursor: pointer;
  border: 1px solid #1e293b;
}

.toolbar-btn:hover {
  background: #111827;
  color: #fff;
}

#status {
  padding: 8px 16px;
  font-size: 13px;
  color: #94a3b8;
}

#viewer {
  padding: 20px;
}

.page {
  position: relative;
  margin: 0 auto 30px;
  background: white;
}

.pdf-text {
  position: absolute;
  cursor: text;
  padding: 2px 4px;
}

.edit-highlight {
  outline: 1px solid rgba(37,99,235,0.6);
  background: rgba(37,99,235,0.08);
}

.match-highlight {
  background: rgba(37,99,235,0.18);
  outline: 1px solid rgba(37,99,235,0.6);
}

.signature {
  position: absolute;
  cursor: move;
}

input, select {
  background: #0b1020;
  border: 1px solid #1e293b;
  color: #e5e7eb;
  padding: 4px;
}
</style>
</head>

<body>

<div class="topbar">
  <strong>PDF Editor</strong>

  <label class="toolbar-btn">
    Upload
    <input type="file" id="fileInput" hidden accept="application/pdf">
  </label>

  <div class="toolbar-btn" id="toggleReplace">Replace</div>
  <div class="toolbar-btn" id="addSignature">Signature</div>
  <div class="toolbar-btn" id="runOCR">OCR</div>
  <div class="toolbar-btn" id="exportBtn">Export</div>

  <div class="toolbar-btn" id="upgradeBtn">Upgrade</div>
</div>

<div class="topbar" id="replacePanel" style="display:none">
  <input id="findInput" placeholder="Find">
  <input id="replaceInput" placeholder="Replace">
  <button class="toolbar-btn" id="findBtn">Find</button>
  <button class="toolbar-btn" id="replaceBtn">Replace</button>
  <button class="toolbar-btn" id="replaceAllBtn">All</button>
</div>

<div id="status">Upload a PDF to begin</div>
<div id="viewer"></div>

<script>
pdfjsLib.GlobalWorkerOptions.workerSrc =
  "https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js";

let isPro = false;
let activeText = null;
let matches = [];

const viewer = document.getElementById("viewer");
const statusEl = document.getElementById("status");

/* ===== FILE LOAD ===== */
fileInput.onchange = async () => {
  viewer.innerHTML = "";
  const file = fileInput.files[0];
  const pdf = await pdfjsLib.getDocument(URL.createObjectURL(file)).promise;

  statusEl.textContent = `Loaded ${pdf.numPages} pages`;

  for (let i = 1; i <= pdf.numPages; i++) {
    const page = await pdf.getPage(i);
    const scale = 1.5;
    const viewport = page.getViewport({ scale });

    const pageDiv = document.createElement("div");
    pageDiv.className = "page";
    pageDiv.style.width = viewport.width + "px";
    pageDiv.style.height = viewport.height + "px";

    const canvas = document.createElement("canvas");
    canvas.width = viewport.width;
    canvas.height = viewport.height;
    pageDiv.appendChild(canvas);

    await page.render({ canvasContext: canvas.getContext("2d"), viewport }).promise;

    const text = await page.getTextContent();
    text.items.forEach(item => {
      const div = document.createElement("div");
      div.className = "pdf-text";
      div.textContent = item.str;
      div.style.left = item.transform[4] * scale + "px";
      div.style.top = viewport.height - item.transform[5] * scale + "px";
      div.style.fontSize = item.height * scale + "px";
      div.contentEditable = true;
      pageDiv.appendChild(div);
    });

    viewer.appendChild(pageDiv);
  }
};

/* ===== SINGLE CLICK EDIT ===== */
document.addEventListener("click", e => {
  const t = e.target.closest(".pdf-text");
  document.querySelectorAll(".pdf-text").forEach(x => x.classList.remove("edit-highlight"));

  if (!t) return;
  activeText = t;
  t.classList.add("edit-highlight");
});

/* ===== FIND & REPLACE ===== */
toggleReplace.onclick = () =>
  replacePanel.style.display = replacePanel.style.display === "flex" ? "none" : "flex";

findBtn.onclick = () => {
  matches = [];
  document.querySelectorAll(".pdf-text").forEach(el => {
    el.classList.remove("match-highlight");
    if (el.textContent.includes(findInput.value)) {
      el.classList.add("match-highlight");
      matches.push(el);
    }
  });
  statusEl.textContent = `${matches.length} matches found`;
};

replaceBtn.onclick = () => {
  if (!isPro) return upgrade();
  if (!matches.length) return;
  const el = matches.shift();
  el.textContent = el.textContent.replace(findInput.value, replaceInput.value);
};

replaceAllBtn.onclick = () => {
  if (!isPro) return upgrade();
  let count = 0;
  document.querySelectorAll(".pdf-text").forEach(el => {
    if (el.textContent.includes(findInput.value)) {
      el.textContent = el.textContent.split(findInput.value).join(replaceInput.value);
      count++;
    }
  });
  statusEl.textContent = `Replaced ${count} occurrences`;
};

/* ===== SIGNATURE ===== */
addSignature.onclick = () => {
  if (!isPro) return upgrade();
  const sig = document.createElement("div");
  sig.textContent = "✍ Your Signature";
  sig.className = "signature";
  sig.style.top = "100px";
  sig.style.left = "100px";
  sig.style.color = "#000";
  viewer.appendChild(sig);
};

/* ===== OCR (BACKEND HOOK) ===== */
runOCR.onclick = () => {
  if (!isPro) return upgrade();
  statusEl.textContent = "OCR queued… (backend required)";
};

/* ===== EXPORT (WATERMARK LOGIC) ===== */
exportBtn.onclick = () => {
  if (!isPro) {
    alert("Watermark applied. Upgrade to remove.");
  } else {
    alert("Exporting clean PDF (next step backend)");
  }
};

/* ===== PAID LOCK ===== */
function upgrade() {
  alert("Upgrade to Pro\n₹99/month | ₹999/year");
}

upgradeBtn.onclick = () => {
  isPro = true;
  statusEl.textContent = "Pro activated (demo mode)";
};
</script>

</body>
</html>
