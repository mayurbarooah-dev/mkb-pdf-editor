<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>ElitePDF — Professional PDF Editor</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf-lib/1.17.1/pdf-lib.min.js"></script>

<style>
:root {
  --bg:#020617;
  --panel:#0f172a;
  --card:#020617;
  --accent:#6366f1;
  --text:#e5e7eb;
  --muted:#9ca3af;
  --border:#1f2937;
}

* { box-sizing:border-box; font-family:Inter,system-ui,sans-serif }

body {
  margin:0;
  background:var(--bg);
  color:var(--text);
}

header {
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:14px 20px;
  border-bottom:1px solid var(--border);
  position:sticky;
  top:0;
  background:rgba(2,6,23,.95);
  z-index:100;
}

.controls, .toolbar {
  display:flex;
  gap:8px;
  align-items:center;
}

button, select, input[type="color"] {
  background:#111827;
  color:var(--text);
  border:1px solid var(--border);
  padding:8px 10px;
  border-radius:8px;
}

button.primary {
  background:var(--accent);
  border:none;
  color:white;
}

main {
  display:flex;
  height:calc(100vh - 60px);
}

#sidebar {
  width:140px;
  border-right:1px solid var(--border);
  overflow-y:auto;
  background:#020617;
}

.thumb {
  padding:8px;
  cursor:pointer;
}
.thumb.active { background:#111827 }

.thumb canvas {
  width:100%;
  border-radius:4px;
}

#editor {
  flex:1;
  overflow-y:auto;
  padding:30px;
}

.page {
  position:relative;
  margin-bottom:40px;
  background:white;
  border-radius:6px;
  box-shadow:0 20px 40px rgba(0,0,0,.5);
}

canvas { width:100%; display:block }

.overlay {
  position:absolute;
  inset:0;
}

.text-box {
  position:absolute;
  min-width:40px;
  min-height:20px;
  padding:2px 4px;
  cursor:move;
  outline:1px dashed transparent;
}

.text-box.selected { outline:1px dashed var(--accent) }

.resizer {
  position:absolute;
  right:-6px;
  bottom:-6px;
  width:12px;
  height:12px;
  background:var(--accent);
  cursor:se-resize;
}

footer {
  text-align:center;
  padding:20px;
  color:var(--muted);
}
</style>
</head>

<body>

<header>
  <div class="controls">
    <input type="file" id="upload" accept="application/pdf">
    <button onclick="downloadPDF()">Download</button>
  </div>

  <div class="toolbar">
    <select id="fontFamily">
      <option>Helvetica</option>
      <option>Times-Roman</option>
      <option>Courier</option>
    </select>

    <select id="fontSize">
      <option>12</option><option>14</option><option>16</option>
      <option>18</option><option>24</option><option>32</option>
    </select>

    <input type="color" id="fontColor" value="#000000">
    <button onclick="zoom(1.1)">+</button>
    <button onclick="zoom(0.9)">−</button>
  </div>
</header>

<main>
  <div id="sidebar"></div>
  <div id="editor"></div>
</main>

<footer>Private • Secure • No Files Stored</footer>

<script>
let pdfBytes, scale=1.4, pagesData=[], selectedBox=null;

pdfjsLib.GlobalWorkerOptions.workerSrc =
"https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js";

document.addEventListener("keydown", e=>{
  if(e.key==="Delete" && selectedBox){
    selectedBox.remove();
    selectedBox=null;
  }
});

document.getElementById("upload").onchange = async e => {
  const file = e.target.files[0];
  pdfBytes = await file.arrayBuffer();
  const pdf = await pdfjsLib.getDocument({data:pdfBytes}).promise;

  editor.innerHTML="";
  sidebar.innerHTML="";
  pagesData=[];

  for(let i=1;i<=pdf.numPages;i++){
    const page = await pdf.getPage(i);
    const vp = page.getViewport({scale});

    const pageDiv=document.createElement("div");
    pageDiv.className="page";

    const canvas=document.createElement("canvas");
    canvas.width=vp.width;
    canvas.height=vp.height;

    const ctx=canvas.getContext("2d");
    await page.render({canvasContext:ctx,viewport:vp}).promise;

    const overlay=document.createElement("div");
    overlay.className="overlay";

    overlay.onclick = e=>{
      const box=document.createElement("div");
      box.contentEditable=true;
      box.className="text-box selected";
      box.style.left=e.offsetX+"px";
      box.style.top=e.offsetY+"px";
      applyStyles(box);
      makeInteractive(box);
      overlay.appendChild(box);
      selectBox(box);
    };

    pageDiv.append(canvas,overlay);
    editor.appendChild(pageDiv);
    pagesData.push({overlay,canvas});

    const tcanvas=document.createElement("canvas");
    tcanvas.width=vp.width/6;
    tcanvas.height=vp.height/6;
    tcanvas.getContext("2d").drawImage(canvas,0,0,tcanvas.width,tcanvas.height);

    const thumb=document.createElement("div");
    thumb.className="thumb";
    thumb.appendChild(tcanvas);
    thumb.onclick=()=>pageDiv.scrollIntoView({behavior:"smooth"});
    sidebar.appendChild(thumb);
  }
};

function makeInteractive(box){
  let ox,oy,drag=false;
  box.onmousedown=e=>{drag=true;ox=e.offsetX;oy=e.offsetY;selectBox(box)};
  document.onmousemove=e=>{
    if(drag){
      box.style.left=(e.pageX-box.parentElement.offsetLeft-ox)+"px";
      box.style.top=(e.pageY-box.parentElement.offsetTop-oy)+"px";
    }
  };
  document.onmouseup=()=>drag=false;

  const r=document.createElement("div");
  r.className="resizer";
  box.appendChild(r);

  r.onmousedown=e=>{
    e.stopPropagation();
    let w=box.offsetWidth,h=box.offsetHeight;
    document.onmousemove=m=>{
      box.style.width=w+(m.pageX-e.pageX)+"px";
      box.style.height=h+(m.pageY-e.pageY)+"px";
    };
    document.onmouseup=()=>document.onmousemove=null;
  };
}

function selectBox(box){
  document.querySelectorAll(".text-box").forEach(b=>b.classList.remove("selected"));
  box.classList.add("selected");
  selectedBox=box;
}

function applyStyles(box){
  box.style.fontFamily=fontFamily.value;
  box.style.fontSize=fontSize.value+"px";
  box.style.color=fontColor.value;
}

fontFamily.onchange=fontSize.onchange=fontColor.onchange=()=>{
  if(selectedBox) applyStyles(selectedBox);
};

function zoom(f){
  scale*=f;
  upload.onchange({target:{files:[upload.files[0]]}});
}

async function downloadPDF(){
  const doc=await PDFLib.PDFDocument.load(pdfBytes);
  const pages=doc.getPages();

  pagesData.forEach((p,i)=>{
    const page=pages[i];
    const {height}=page.getSize();
    p.overlay.querySelectorAll(".text-box").forEach(b=>{
      page.drawText(b.innerText,{
        x:parseFloat(b.style.left),
        y:height-parseFloat(b.style.top)-16,
        size:parseInt(b.style.fontSize),
        color:PDFLib.rgb(0,0,0)
      });
    });
  });

  const out=await doc.save();
  const a=document.createElement("a");
  a.href=URL.createObjectURL(new Blob([out],{type:"application/pdf"}));
  a.download="edited.pdf";
  a.click();
}
</script>

</body>
</html>
