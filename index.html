<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>MKB PDF Editor</title>

<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- PDF.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>

<style>
body {
  margin: 0;
  font-family: Inter, system-ui, -apple-system, BlinkMacSystemFont;
  background: #f5f7fb;
  color: #111;
}

header {
  background: #ffffff;
  border-bottom: 1px solid #e5e7eb;
  padding: 16px 24px;
  font-size: 20px;
  font-weight: 600;
}

.toolbar {
  display: flex;
  gap: 12px;
  padding: 16px 24px;
  background: #fff;
  align-items: center;
}

button {
  padding: 10px 16px;
  border-radius: 8px;
  border: none;
  background: #2563eb;
  color: white;
  font-weight: 500;
  cursor: pointer;
}

button.secondary {
  background: #e5e7eb;
  color: #111;
}

#status {
  padding: 8px 24px;
  font-size: 14px;
  color: #555;
}

#viewer {
  padding: 24px;
}

.page {
  position: relative;
  margin-bottom: 32px;
  background: white;
  box-shadow: 0 10px 30px rgba(0,0,0,0.08);
}

canvas {
  display: block;
}

.text-layer {
  position: absolute;
  inset: 0;
}

.text-box {
  position: absolute;
  min-width: 80px;
  min-height: 24px;
  padding: 2px 4px;
  border: 1px dashed #3b82f6;
  cursor: text;
  font-size: 16px;
  background: transparent;
}
</style>
</head>

<body>

<header>MKB PDF Editor</header>

<div class="toolbar">
  <input type="file" id="fileInput" accept="application/pdf">
  <button id="addText" class="secondary">Add Text</button>
  <button id="download">Download PDF</button>
</div>

<div id="status">Waiting for PDF…</div>

<div id="viewer"></div>

<script>
pdfjsLib.GlobalWorkerOptions.workerSrc =
  "https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js";

let pdfDoc = null;
let currentTextMode = false;

const status = document.getElementById("status");
const viewer = document.getElementById("viewer");

document.getElementById("fileInput").addEventListener("change", async e => {
  viewer.innerHTML = "";
  status.textContent = "Loading PDF…";

  try {
    const file = e.target.files[0];
    const buffer = await file.arrayBuffer();
    pdfDoc = await pdfjsLib.getDocument({ data: buffer }).promise;

    status.textContent = `Loaded ${pdfDoc.numPages} pages`;

    for (let i = 1; i <= pdfDoc.numPages; i++) {
      const page = await pdfDoc.getPage(i);
      const viewport = page.getViewport({ scale: 1.5 });

      const pageDiv = document.createElement("div");
      pageDiv.className = "page";
      pageDiv.style.width = viewport.width + "px";
      pageDiv.style.height = viewport.height + "px";

      const canvas = document.createElement("canvas");
      canvas.width = viewport.width;
      canvas.height = viewport.height;

      const ctx = canvas.getContext("2d");
      await page.render({ canvasContext: ctx, viewport }).promise;

      const textLayer = document.createElement("div");
      textLayer.className = "text-layer";

      pageDiv.append(canvas, textLayer);
      viewer.appendChild(pageDiv);
    }
  } catch (err) {
    console.error(err);
    status.textContent = "❌ Failed to load PDF";
  }
});

document.getElementById("addText").onclick = () => {
  currentTextMode = true;
  status.textContent = "Click anywhere on a page to add text";
};

viewer.addEventListener("click", e => {
  if (!currentTextMode) return;
  const page = e.target.closest(".page");
  if (!page) return;

  const box = document.createElement("div");
  box.contentEditable = true;
  box.className = "text-box";
  box.style.left = e.offsetX + "px";
  box.style.top = e.offsetY + "px";
  box.textContent = "Edit text";

  page.querySelector(".text-layer").appendChild(box);
  box.focus();

  currentTextMode = false;
});
</script>

</body>
</html>
